#!/bin/sh

# Show wifi üõú and percent strength or üì° if none.
# Show üåê if connected to ethernet or ‚ùé if none.
# Show üõ∞Ô∏è if a vpn connection is active

case $BLOCK_BUTTON in
1)
  "$TERMINAL" -e nmtui
  pkill -RTMIN+7 dwmblocks
  ;;
3) notify-send "üåê Internet module" "\- Left click to connect
‚ùå: wifi disabled
üì°: no wifi connection
üõú: wifi connection with quality
‚ùé: no ethernet
üåê: ethernet working
üõ∞Ô∏è: vpn is active
" ;;
6) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;;
esac

# Wifi
if grep -q 'up' /sys/class/net/w*/operstate; then
  wifiicon="$(awk '/^\s*w/ { print "üõú" int($3 * 100 / 70) "%" }' /proc/net/wireless)"
elif grep -q 'down' /sys/class/net/w*/operstate; then
  grep -q '0x1003' /sys/class/net/w*/flags && wifiicon="üì°" || wifiicon="‚ùå"
fi

# Ethernet
grep -q 'up' /sys/class/net/e*/operstate && ethericon="üåê" || ethericon="‚ùé"

# TUN
[ -n "$(cat /sys/class/net/tun*/operstate 2>/dev/null)" ] && tunicon="üõ∞Ô∏è"

icons=""
[ -n "$wifiicon" ] && icons="${icons}$wifiicon "
[ -n "$ethericon" ] && icons="${icons}$ethericon "
[ -n "$tunicon" ] && icons="${icons}$tunicon "

printf "%s\n" "${icons% }"
