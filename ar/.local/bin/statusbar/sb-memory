#!/bin/sh

case $BLOCK_BUTTON in
1) notify-send "ğŸ Memory hogs" "$(ps axch -o cmd,%mem | awk '{cmd[$1]+=$2} END {for (i in cmd) print i, cmd[i]}' | sort -nrk2 | head)" ;;
2) setsid -f "$TERMINAL" -e htop ;;
3) notify-send "ğŸ Memory module" "\- Shows Memory temperature and used/total
- Left click to show memory hogs
- Middle click to open htop
ğŸŒ¡ï¸: Memory temperature" ;;
6) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;;
esac

width=$(xrandr | grep "\*" | awk '{print $1}' | sed 's/x[0-9]*//g' | head -n1)
nvme_temp=$(sensors 2>/dev/null |
  awk '/Composite:/ {gsub(/[+Â°C]/,"",$2); print $2; exit}')

if [ -n "$width" ] && [ "$width" -eq "$width" ] 2>/dev/null; then
  if [ "$width" -lt 1920 ]; then
    free --mebi | sed -n '2{p;q}' |
      awk -v t="$nvme_temp" '{printf "ğŸŒ¡%sÂ° ğŸ%d%%\n", t, ($3/$2)*100+0.5}'
  else
    free --mebi | sed -n '2{p;q}' |
      awk -v t="$nvme_temp" '{printf "ğŸŒ¡%sÂ° ğŸ%dGB/%dGB", t, $3/1000+0.5, $2/1000+0.5}'
  fi
fi
